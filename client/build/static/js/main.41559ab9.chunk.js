(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{223:function(e,t,n){},225:function(e,t,n){},226:function(e,t,n){},236:function(e,t,n){},237:function(e,t,n){},240:function(e,t,n){},243:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n(77),o=n.n(s),c=(n(223),n(37)),r=n(17),i=(n(224),n(270)),l=(n(225),n(26)),j=n(15),b=n(281),u=n(61),d=n(71),O=n(39),m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(a.useState)(t),s=Object(j.a)(n,2),o=s[0],c=s[1],r=function(e){c(Object(O.a)(Object(O.a)({},o),{},Object(d.a)({},e.target.name,e.target.value)))},i=function(t){t.preventDefault(),e()};return{onChange:r,onSubmit:i,values:o}},h=n(271),p=n(277),x=(n(226),n(192)),g=n(3),f={user:null};if(localStorage.getItem("jwtToken")){var v=Object(x.a)(localStorage.getItem("jwtToken"));1e3*v.exp<Date.now()?localStorage.removeItem("jwtToken"):f.user=v}var C,I=Object(a.createContext)({user:null,login:function(e){},logout:function(){}});function w(e,t){switch(t.type){case"LOGIN":return Object(O.a)(Object(O.a)({},e),{},{user:t.payload});case"LOGOUT":return console.log("INSIDE LOGOUT METHOD UIN THE REDUCER"),Object(O.a)(Object(O.a)({},e),{},{user:null});default:return e}}function y(e){var t=Object(a.useReducer)(w,f),n=Object(j.a)(t,2),s=n[0],o=n[1];return Object(g.jsx)(I.Provider,Object(O.a)({value:{user:s.user,login:function(e){localStorage.setItem("jwtToken",e.token),o({type:"LOGIN",payload:e})},logout:function(){console.log("INSIDE LOGOUT METHOD"),localStorage.removeItem("jwtToken"),o({type:"LOGOUT"})}}},e))}var k,P,S,E,$,N,T,D,L=Object(u.a)(C||(C=Object(l.a)(["\nmutation login(\n    $username : String!,\n    $password : String!\n){\n    login(\n        username : $username,\n        password : $password,\n    ){\n        id email username createdAt token\n    }\n}"]))),A=function(e){var t=Object(a.useContext)(I),n=Object(a.useState)({}),s=Object(j.a)(n,2),o=s[0],c=s[1],r=m((function(){x()}),{username:"",password:""}),i=r.onChange,l=r.onSubmit,u=r.values,d=Object(b.a)(L,{update:function(n,a){console.log(a),t.login(a.data.login),e.history.push("/")},onError:function(e){var t;c(null===(t=e.graphQLErrors[0])||void 0===t?void 0:t.extensions.exception.errors)},variables:u}),O=Object(j.a)(d,2),x=O[0],f=O[1].loading;return Object(g.jsxs)("div",{className:"Login",children:[Object(g.jsxs)(h.a,{onSubmit:l,noValidate:!0,className:f?"loading":"",children:[Object(g.jsx)("h1",{children:"Login"}),Object(g.jsx)(h.a.Input,{label:"Username",placeholder:"Username..",name:"username",value:u.username,error:!!o.username,onChange:i}),Object(g.jsx)(h.a.Input,{label:"Password",placeholder:"Password..",name:"password",value:u.password,error:!!o.password,type:"password",onChange:i}),Object(g.jsx)(p.a,{type:"submit",primary:!0,children:"Login"})]}),Object.keys(o).length?Object(g.jsx)("div",{className:"ui error message",children:Object(g.jsx)("ul",{className:"list",children:Object.values(o).map((function(e){return Object(g.jsx)("li",{children:e},e)}))})}):null]})},U=(n(236),Object(u.a)(k||(k=Object(l.a)(["\nmutation register(\n    $username : String!,\n    $email : String!,\n    $password : String!,\n    $confirmPassword : String!,\n){\n    register(registerInput : {\n        username : $username,\n        email : $email,\n        password : $password,\n        confirmPassword : $confirmPassword\n    }){\n        id email username createdAt token\n    }\n}"])))),R=function(e){var t=Object(a.useContext)(I),n=Object(a.useState)({}),s=Object(j.a)(n,2),o=s[0],c=s[1],r=m((function(){x()}),{username:"",password:"",email:"",confirmPassword:""}),i=r.onChange,l=r.onSubmit,u=r.values,d=Object(b.a)(U,{update:function(n,a){t.login(a.data.register),e.history.push("/")},onError:function(e){var t;c(null===(t=e.graphQLErrors[0])||void 0===t?void 0:t.extensions.exception.errors)},variables:u}),O=Object(j.a)(d,2),x=O[0],f=O[1].loading;return Object(g.jsxs)("div",{className:"Register",children:[Object(g.jsxs)(h.a,{onSubmit:l,noValidate:!0,className:f?"loading":"",children:[Object(g.jsx)("h1",{children:"Register"}),Object(g.jsx)(h.a.Input,{label:"Username",placeholder:"Username..",name:"username",value:u.username,error:!!o.username,onChange:i}),Object(g.jsx)(h.a.Input,{label:"Email",placeholder:"Email..",name:"email",value:u.email,error:!!o.email,onChange:i}),Object(g.jsx)(h.a.Input,{label:"Password",placeholder:"Password..",name:"password",value:u.password,error:!!o.password,type:"password",onChange:i}),Object(g.jsx)(h.a.Input,{label:"Confirm Password",placeholder:"Confirm Password ..",name:"confirmPassword",value:u.confirmPassword,error:!!o.confirmPassword,type:"password",onChange:i}),Object(g.jsx)(p.a,{type:"submit",primary:!0,children:"Register"})]}),Object.keys(o).length?Object(g.jsx)("div",{className:"ui error message",children:Object(g.jsx)("ul",{className:"list",children:Object.values(o).map((function(e){return Object(g.jsx)("li",{children:e},e)}))})}):null]})},F=n(268),H=n(279),G=n(273),z=n(276),M=n(198),B=n(106),Q=n(114),q=(n(237),Object(u.a)(P||(P=Object(l.a)(["\n    mutation likePost($postId : ID!){\n        likePost(postId : $postId){\n            id\n            likes{\n                id \n                username\n            }\n            likeCount\n        }\n    }\n"])))),J=function(e){var t=e.post,n=t.id,s=t.likeCount,o=t.likes,r=e.user,i=Object(a.useState)(!1),l=Object(j.a)(i,2),u=l[0],d=l[1];Object(a.useEffect)((function(){r&&o.find((function(e){return e.username===r.username}))?d(!0):d(!1)}),[r,o]);var O=Object(b.a)(q,{variables:{postId:n}}),m=Object(j.a)(O,1)[0],h=r?u?Object(g.jsx)(p.a,{color:"teal",children:Object(g.jsx)(B.a,{name:"heart"})}):Object(g.jsx)(p.a,{color:"teal",basic:!0,children:Object(g.jsx)(B.a,{name:"heart"})}):Object(g.jsx)(p.a,{as:c.b,to:"/login",color:"teal",basic:!0,children:Object(g.jsx)(B.a,{name:"heart"})});return Object(g.jsxs)(p.a,{as:"div",labelPosition:"right",onClick:m,children:[h,Object(g.jsx)(Q.a,{basic:!0,color:"teal",pointing:"left",children:s})]})},V=n(148),W=n.n(V),K=n(275),X=Object(u.a)(S||(S=Object(l.a)(["\n    mutation deletePost($postId : ID!){\n        deletePost(postId : $postId)\n    }\n"]))),Y=function(e){var t=e.postId,n=e.callback,s=Object(a.useState)(!1),o=Object(j.a)(s,2),c=o[0],r=o[1],i=Object(b.a)(X,{update:function(){r(!1),console.log("INSIDE DELETE UPDATE"),n&&n()},variables:{postId:t}}),l=Object(j.a)(i,1)[0];return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(p.a,{color:"red",floated:"right",clearing:!0,segment:!0,size:"tiny",basic:!0,onClick:function(){return r(!0)},children:Object(g.jsx)(B.a,{name:"trash"})}),Object(g.jsx)(K.a,{open:c,onCancel:function(){return r(!1)},onConfirm:l})]})},Z=Object(u.a)(E||(E=Object(l.a)(["\nmutation deletePost($postId : ID!){\n    deletePost(postId : $postId)\n}\n"]))),_=function(e){var t,n=Object(a.useContext)(I).user,s=e.post,o=s.id,r=s.username,i=s.body,l=s.createdAt,u=s.likeCount,O=s.commentCount,m=s.likes,h=Object(b.a)(Z,{variables:{postId:o},update:function(e,t){console.log(t)}}),x=Object(j.a)(h,2),f=(x[0],x[1]);f.loading,f.error;return Object(g.jsxs)(z.a,{fluid:!0,children:[Object(g.jsxs)(z.a.Content,{children:[Object(g.jsx)(M.a,{floated:"right",size:"mini",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"}),Object(g.jsx)(z.a.Header,{children:r}),Object(g.jsx)(z.a.Meta,{as:c.b,to:"/posts/".concat(o),children:Object(g.jsx)("span",{className:"date",children:"Create on : ".concat(W()(l).fromNow())})}),Object(g.jsx)(z.a.Description,{children:i})]}),Object(g.jsx)(z.a.Content,{extra:!0,children:Object(g.jsxs)("a",{children:[Object(g.jsx)(J,{post:{id:o,likes:m,likeCount:u},user:n}),Object(g.jsxs)(p.a,(t={as:"div",labelPosition:"right"},Object(d.a)(t,"as",c.b),Object(d.a)(t,"to","/post/".concat(o)),Object(d.a)(t,"children",[Object(g.jsx)(p.a,{color:"blue",size:"tiny",basic:!0,children:Object(g.jsx)(B.a,{name:"comments"})}),Object(g.jsx)(Q.a,{as:"a",basic:!0,color:"blue",pointing:"left",children:O})]),t)),n&&r===n.username&&Object(g.jsx)(Y,{postId:o})]})})]})},ee=Object(u.a)($||($=Object(l.a)(["\n{\n    getPosts{\n        id\n        body\n        createdAt\n        username\n        likeCount\n        likes{\n            username\n\n        }\n        commentCount\n        comments{\n            body\n        }\n    }\n}"]))),te=(Object(u.a)(N||(N=Object(l.a)(["\nmutation deletePost($postId : ID!){\n    deletePost(postId : $postId)\n}\n"]))),n(240),n(172)),ne=n.n(te),ae=n(197),se=n(200),oe=n(201),ce=function(e){var t=m((function(){return l.apply(this,arguments)}),{body:""}),n=t.values,a=t.onChange,s=t.onSubmit,o=Object(b.a)(re,{variables:n,update:function(e,t){var a=e.readQuery({query:ee});a.getPosts=[t.data.createPost].concat(Object(se.a)(a.getPosts)),e.writeQuery({query:ee,data:a}),console.log(t),n.body=""},onError:function(e){console.log(e)}}),c=Object(j.a)(o,2),r=c[0],i=c[1].error;function l(){return(l=Object(ae.a)(ne.a.mark((function e(){return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)(h.a,{onSubmit:s,children:[Object(g.jsx)("h2",{children:" Create a Post: "}),Object(g.jsxs)(h.a.Field,{children:[Object(g.jsx)(oe.a,{placeholder:"Hi World",name:"body",onChange:a,value:n.body,error:!!i}),Object(g.jsx)(p.a,{type:"submit",color:"teal",children:"Submit"})]})]}),i&&Object(g.jsx)("div",{className:"ui error message",style:{marginBottom:20},children:Object(g.jsx)("ul",{className:"list",children:Object(g.jsx)("li",{children:i.graphQLErrors[0].message})})})]})},re=Object(u.a)(T||(T=Object(l.a)(["\nmutation createPost($body : String!){\n    createPost(body : $body){\n        id body createdAt username\n        likes {\n            id username createdAt\n        }\n        likeCount\n        comments {\n            id body createdAt\n        }\n        commentCount\n    }\n}\n"]))),ie=function(e){var t=Object(a.useContext)(I).user,n=Object(F.a)(ee,{fetchPolicy:"network-only"}),s=Object(j.a)(n,2),o=s[0],c=s[1],r=c.loading,i=c.data;return Object(a.useEffect)((function(){console.log("FETCHING POSTS"),o(),console.log("FETCHED POSTS")}),[]),Object(g.jsx)("div",{className:"Home",children:Object(g.jsxs)(H.a,{columns:"three",divided:!0,children:[Object(g.jsx)(H.a.Row,{className:"page-title",children:Object(g.jsx)("h1",{children:"Recent Posts"})}),Object(g.jsxs)(H.a.Row,{children:[t&&Object(g.jsx)(H.a.Column,{children:Object(g.jsx)(ce,{refreshPosts:o})}),r?Object(g.jsx)("h1",{children:"Loading ... "}):Object(g.jsx)(G.a.Group,{children:i&&i.getPosts.map((function(e){return Object(g.jsx)(H.a.Column,{style:{marginBottom:"20px"},children:Object(g.jsx)(_,{refreshPosts:o,post:e})},e.id)}))})]})]})})},le=n(272),je=function(e){var t=Object(a.useContext)(I),n=t.user,s=t.logout,o=function(e,t){var n=t.name;return d(n)},r=window.location.pathname,i="/"===r?"home":r.substr(1),l=Object(a.useState)(i),b=Object(j.a)(l,2),u=b[0],d=b[1];return n?Object(g.jsx)("div",{children:Object(g.jsxs)(le.a,{pointing:!0,secondary:!0,color:"teal",size:"massive",children:[Object(g.jsx)(le.a.Item,{name:n.username,active:!0,as:c.b,to:"/"}),Object(g.jsx)(le.a.Menu,{position:"right",children:Object(g.jsx)(le.a.Item,{name:"logout",onClick:s,as:c.b,to:"/login"})})]})}):Object(g.jsx)("div",{children:Object(g.jsxs)(le.a,{pointing:!0,secondary:!0,color:"teal",size:"massive",children:[Object(g.jsx)(le.a.Item,{name:"home",active:"home"===u,onClick:o,as:c.b,to:"/"}),Object(g.jsxs)(le.a.Menu,{position:"right",children:[Object(g.jsx)(le.a.Item,{name:"login",active:"login"===u,onClick:o,as:c.b,to:"/login"}),Object(g.jsx)(le.a.Item,{name:"register",active:"register"===u,onClick:o,as:c.b,to:"/register"})]})]})})},be=n(202),ue=function(e){var t=e.component,n=Object(be.a)(e,["component"]),s=Object(a.useContext)(I).user;return Object(g.jsx)(r.b,Object(O.a)(Object(O.a)({},n),{},{render:function(e){return s?Object(g.jsx)(r.a,{to:"/"}):Object(g.jsx)(t,Object(O.a)({},e))}}))},de=n(269),Oe=Object(u.a)(D||(D=Object(l.a)(["\n    query($postId : ID!){\n        getPost(postId : $postId){\n            id\n            body\n            createdAt\n            username\n            likes{\n                username\n            }\n            commentCount\n            comments{\n                id\n                createdAt\n                body\n            }\n        }\n    }\n"]))),me=function(e){var t=e.match.params.postId,n=Object(a.useContext)(I);console.log(t);var s,o=Object(de.a)(Oe,{variables:{postId:t}}).data;if(o){var c=o.getPost,r=c.id,i=c.body,l=c.createdAt,j=c.username,b=(c.comments,c.likes),u=c.likeCount,d=c.commentCount;console.log(n.user.username,j);s=Object(g.jsx)(H.a,{children:Object(g.jsxs)(H.a.Row,{children:[Object(g.jsx)(H.a.Column,{width:2,children:Object(g.jsx)(M.a,{floated:"right",size:"small",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"})}),Object(g.jsx)(H.a.Column,{width:10,children:Object(g.jsxs)(z.a,{fluid:!0,children:[Object(g.jsxs)(z.a.Content,{children:[Object(g.jsx)(z.a.Header,{children:j}),Object(g.jsx)(z.a.Meta,{children:W()(l).fromNow()}),Object(g.jsx)(z.a.Description,{children:i})]}),Object(g.jsx)("hr",{}),Object(g.jsxs)(z.a.Content,{extra:!0,children:[Object(g.jsx)(J,{user:n,post:{id:r,likeCount:u,likes:b}}),Object(g.jsxs)(p.a,{as:"div",labelPositon:"right",onClick:function(){return console.log("Comment on Post")},children:[Object(g.jsx)(p.a,{basic:!0,color:"blue",children:Object(g.jsx)(B.a,{name:"comments"})}),Object(g.jsx)(Q.a,{basic:!0,color:"blue",pointing:"left",children:d})]}),n&&n.user.username===j&&Object(g.jsx)(Y,{callback:function(){e.history.push("/")},postId:t})]})]})})]})})}else s=Object(g.jsx)("p",{children:"Loading"});return s},he=function(e){return Object(g.jsx)(y,{children:Object(g.jsx)(c.a,{children:Object(g.jsxs)(i.a,{children:[Object(g.jsx)(je,{}),Object(g.jsx)(r.b,{exact:!0,path:"/",component:ie}),Object(g.jsx)(ue,{exact:!0,path:"/login",component:A}),Object(g.jsx)(ue,{exact:!0,path:"/register",component:R}),Object(g.jsx)(r.b,{exact:!0,path:"/posts/:postId",component:me})]})})})},pe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,282)).then((function(t){var n=t.getCLS,a=t.getFID,s=t.getFCP,o=t.getLCP,c=t.getTTFB;n(e),a(e),s(e),o(e),c(e)}))},xe=n(274),ge=n(42),fe=n(167),ve=n(199),Ce=n(242),Ie=new xe.a({uri:"https://social-media-react-merng.herokuapp.com/graphql"}),we=new ge.ApolloLink((function(e,t){var n=localStorage.getItem("jwtToken");return e.setContext({headers:{Authorization:n?"Bearer ".concat(n):""}}),t(e)})),ye=new fe.a({link:we.concat(Ie),cache:new ve.a}),ke=Object(g.jsx)(Ce.a,{client:ye,children:Object(g.jsx)(he,{})});o.a.render(ke,document.getElementById("root")),pe()}},[[243,1,2]]]);
//# sourceMappingURL=main.41559ab9.chunk.js.map